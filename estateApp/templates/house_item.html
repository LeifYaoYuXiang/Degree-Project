{% extends 'front_end_base.html' %}
{% import 'macro.html' as macro %}

{% block head %}
    <meta charset="UTF-8">
    <script src="http://www.jq22.com/jquery/jquery-1.10.2.js"></script>
    <style>

        ul, li, ol {
            list-style: none;
        }

        /* é‡ç½®æ–‡æœ¬æ ¼å¼å…ƒç´  */
        a {
            text-decoration: none;
            cursor: pointer;
            color: #333333;
        {#font-size: 14px;#}
        }

        a:hover {
            text-decoration: none;
        }

        .clearfix::after {
            display: block;
            content: '';
            height: 0;
            overflow: hidden;
            clear: both;
        }

        /*æ˜Ÿæ˜Ÿæ ·å¼*/
        .content {
            width: 600px;
            margin: 0 auto;
            padding-top: 20px;
        }

        .title {
            font-size: 14px;
            background: #dfdfdf;
            padding: 10px;
            margin-bottom: 10px;
        }

        .block {
            margin: 0px 0 0 0;
            height: 21px;
        }

        .block .star_score {
            float: left;
        }

        .star_list {
            height: 21px;
            margin: 50px;
            line-height: 21px;
        }

        .block p, .block .attitude {
            padding-left: 20px;
            display: inline-block;
        }

        .block p span {
            color: #C00;
            font-size: 16px;
            font-family: Georgia, "Times New Roman", Times, serif;
        }

        .star_score {
            background: url(../static/front_end/img/ratings/stark2.png);
            width: 160px;
            height: 21px;
            position: relative;
        }

        .star_score a {
            height: 21px;
            display: block;
            text-indent: -999em;
            position: absolute;
            left: 0;
        }

        .star_score a:hover {
            background: url(../static/front_end/img/ratings/stars2.png);
            left: 0;
        }

        .star_score a.clibg {
            background: url(../static/front_end/img/ratings/stars2.png);
            left: 0;
        }

        /*æ˜Ÿæ˜Ÿæ ·å¼*/

        .show_number {
            padding-left: 0px;
            margin: 0px 0 -2.5px 0;
        }

        .show_number li {
            margin-right: 5px;
        }

        .atar_Show {
            background: url(../static/front_end/img/ratings/stark2.png);
            width: 160px;
            height: 21px;
            position: relative;
            float: left;
        }

        .atar_Show p {
            background: url(../static/front_end/img/ratings/stars2.png);
            left: 0;
            height: 21px;
            width: 134px;
        }

        .show_number li span {
            display: inline-block;
            line-height: 21px;
        }

    </style>


    <link href="https://cdn.bootcss.com/bootstrap/3.3.7/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.bootcss.com/bootstrap-datetimepicker/4.17.47/css/bootstrap-datetimepicker.min.css"
          rel="stylesheet">

    <script src="https://cdn.bootcss.com/jquery/3.3.1/jquery.js"></script>
    <script src="https://cdn.bootcss.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
    <script src="https://cdn.bootcss.com/moment.js/2.22.0/moment-with-locales.js"></script>
    <script src="https://cdn.bootcss.com/bootstrap-datetimepicker/4.17.47/js/bootstrap-datetimepicker.min.js"></script>


{% endblock %}

{% block front_end_main_content %}
    <!-- hero-area start -->
    <section class="hero-area pos-rel">

        <div class="hero-slider">

        </div>
    </section>
    <!-- hero-area end -->

    <section class="events-area-03 pt-130 pb-100">
        <div class="container">
            <div class="row">
                <div class="col-xl-12">
                    <p id="week_number" style="display: none">{{ week_number }}</p>
                    <p id="house_id" style="display: none">{{ house_id }}</p>
                    <p id="house_type" style="display: none">{{ house_type_num }}</p>
                    <div class="events-wrapper-03 d-lg-flex align-items-center justify-content-between mb-30">

                        <div class="events-thumb" style="margin-left: 20px; margin-bottom: 75px">
                            {#                            <h6>{{ house_name}}</h6>#}
                            <img width="600" height="420"
                                 src="{{ url_for('static', filename='image/'~(house_id%210)~'.jpg') }}">
                        </div>

                        <div class="events-contents pos-rel" style="margin-left: -37px; width: 60%;">
                            <div class="tags">
                                <a style="width: 0;height: 0;"
                                   href="{{ url_for('house_inspector_item', id=inspector_id) }}">
                                    <img style="margin-bottom: 65px; margin-top: 18px; margin-left: 14px; border-radius: 50%;"
                                         src="{{ url_for('static', filename='front_end/img/team/0' ~ inspector_id ~ '.jpg') }}"
                                         width="78" height="78">
                                </a>
                                <div style="width: 160px; text-align: center"><h5
                                        style="margin-right: 52px;"><b>{{ inspector_name }}</b></h5></div>
                                {#                                <h5 style="position: relative">{{ inspector_name }}</h5>#}
                            </div>
                            <div style="margin-bottom: 38px;">
                                <h2 style="color: red; margin-top: 4px">Â¥ {{ price }}/ã¡</h2>
                                {#                                <h5>123ã¡</h5>#}
                            </div>
                            <div class="events-meta">
                                                            <span style="width: 100%; margin-top: 8px; ">
{#                                                                <i class="far fa-calendar-alt"></i>{{ house_size }} &nbsp;&nbsp;&nbsp;#}
                                                                <i class="far fa-calendar-alt"></i>{{ house_size }} &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                                                                <i class="fal fa-home"></i>{{ house_room }}
{#                                                                <i class="fal fa-home"></i>test#}
                                                                <hr style="margin-top: 8px">
                                                            </span>


                                <span style="width: 100%;"><span style="width: 105px; height: 0;">House Type:</span> &nbsp;<a
                                        style="cursor:default; font-size: medium; text-transform: none; color: black;"><b> {{ house_type }}</b></a></span>
                                <span style="width: 475px; overflow:hidden;white-space:nowrap;text-overflow:ellipsis"><span style="width: 105px; height: 0;">House Name:</span> &nbsp;<a id="house_name" onclick="a()"
                                        style="font-size: medium;text-transform: none; color: black;"><b> {{ house_name }}</b></a></span>
                                <span style="width: 100%;"><span style="width: 105px; height: 0;">Province/City:</span> &nbsp;<a
                                        style="cursor: default; font-size: medium; text-transform: none; color: black;"><b> {{ house_city }}</b></a></span>
                                <span style="width: 475px; overflow:hidden;white-space:nowrap;text-overflow:ellipsis"><span
                                        style="width: 105px;height: 0;">Address:</span> &nbsp;<a id="address" onclick="b()"
                                        style="height: 0; font-size: medium;text-transform: none; color: black;"><b> {{ house_district }}</b></a></span>
                                <span style="width: 100%;"><span style="width: 105px; height: 0;">Looking Time:</span> &nbsp;<a
                                        style="cursor: default; font-size: medium;text-transform: none; color: black;"><b> {{ available_time }}</b></a></span>


                            </div>


                            <a style="cursor:not-allowed;background-color: #ea5822; color: white;"
                                    class="c-btn btn-group-sm mt-15">ğŸ“ &nbsp;(+86) {{ inspector_phone }}
                            </a>
                            &nbsp;&nbsp;&nbsp;&nbsp;
                            <a class="c-btn btn-blue-style mt-15" href="javascript:void(0)"
                               onclick="document.getElementById('light').style.display='block';document.getElementById('fade').style.display='block'"><i
                                    class="fal fa-clock"></i> &nbsp;Book a time
                                <i class="far fa-long-arrow-alt-right"></i>
                            </a>

                            <hr>
                            {% if rating==-1 %}
                                <div id="startone" class="block clearfix">
                                    <div class="star_score"></div>
                                    <p style="font-size: medium">Ratingï¼š<span class="fenshu"></span> &nbsp;
                                    </p>
                                    <div class="attitude"></div>
                                </div>
                            {% else %}
                                <ul class="show_number clearfix">
                                    <li>
                                        <div class="atar_Show">
                                            <p tip={{ rating }}></p>
                                        </div> &nbsp;&nbsp;&nbsp;
                                        <span style="color: black"></span>
                                    </li>
                                </ul>
                            {% endif %}

                        </div>
                    </div>

                </div>

            </div>
            <div id="light" class="white_content"
                 style="display: none;position: fixed; top: 15%;left: 23%;width: 55%; height: 75%;padding: 20px;border: 10px solid orange;background-color: white;z-index:1002;overflow: auto;">
                <h1 style="text-align: center">Contact Agent</h1>
                <hr>
                <h4> House Name: {{ house_name }} &nbsp;&nbsp;|&nbsp;&nbsp; House Inspector: {{ inspector_name }}</h4>
                <form class="subscribe" action="" method="post">
                    {{ appointment_form.hidden_tag() }}
                    <div class="input-group date" style="width: 14em; margin-bottom: 10px" id='date'>
                        {{ appointment_form.time(class="form-control") }}
                        <span class="input-group-addon">
                        <span class="glyphicon glyphicon-calendar"></span>
                        </span>
                    </div>
                    <div class="input-text">
                        {{ appointment_form.message(cols=30,rows=10) }}
                    </div>
                    <div style="text-align: center">
                        {{ appointment_form.submit(class="c-btn") }} &nbsp;&nbsp;
                        <a class="c-btn" href="javascript:void(0)"
                           onclick="document.getElementById('light').style.display='none';document.getElementById('fade').style.display='none'">Cancel</a>

                    </div>
                </form>
            </div>
            <div id="fade" class="black_overlay"
                 style="display: none;position: fixed;top: 0%; left: 0%;width: 100%;height: 100%; background-color: black;z-index:1001;-moz-opacity: 0.8;opacity:.80;filter: alpha(opacity=88);">
            </div>
        </div>
    </section>

    <!-- result-cards-start -->
    <div class="course-cat-area pt-55 pb-100" style="margin-top: -127px;">
        <div class="container">
            <!-- result-num-start -->
            <div class="row">
                <div class="col-xl-6 col-lg-6 offset-lg-3 offset-xl-3">
                    <div class="section-title text-center mb-60">
                            <span><i class="fal fa-ellipsis-h"></i>  We recommend houses that are near to this house
                                <i class="fal fa-ellipsis-h"></i></span>
                    </div>
                </div>
            </div>
            <!-- result-num-end -->

            <!-- house-result-list-start -->
            <div class="row">
                {% for result_house_item in recommendation_house %}
                    {{ macro.house_item_display(
                        id=result_house_item.id,
                        image_url=result_house_item.image_url,
                        house_name=result_house_item.house_name,
                        address=result_house_item.address,
                        price=result_house_item.price,
                        house_inspector_name=result_house_item.house_inspector_name ) }}
                {% endfor %}
            </div>
            <!-- house-result-list-end -->

        </div>
    </div>
    <!-- result-cards-end -->

    <script>
        function scoreFun(object, opts) {
            // é»˜è®¤å±æ€§
            var defaults = {
                fen_d: 16,  // æ¯ä¸ªaçš„å®½åº¦
                ScoreGrade: 10,  // açš„ä¸ªæ•°
                types: ["Extremely awful",
                    "Very unsatisfied",
                    "So bad",
                    "Quite awful",
                    "Not that satisfied",
                    "Just so so",
                    "Above the average",
                    "Good",
                    "Very good!",
                    "Excellent!",
                ],
                nameScore: "fenshu",
                parent: "star_score",
                attitude: "attitude"
            };
            options = $.extend({}, defaults, opts);
            var countScore = object.find("." + options.nameScore);  // æ‰¾åˆ°åä¸ºâ€œfenshuâ€çš„ç±»
            var startParent = object.find("." + options.parent);    // æ‰¾åˆ°åä¸ºâ€œstar_scoreâ€çš„ç±»
            var atti = object.find("." + options.attitude);    // æ‰¾åˆ°åä¸ºâ€œattitudeâ€çš„ç±»
            var now_cli;
            var fen_cli;
            var atu;
            var fen_d = options.fen_d;     // æ¯ä¸ªaçš„å®½åº¦
            var len = options.ScoreGrade;  // æŠŠaçš„ä¸ªæ•°èµ‹å€¼ç»™len
            startParent.width(fen_d * len); //åŒ…å«açš„divç›’å­çš„å®½åº¦
            var preA = (5 / len);
            for (var i = 0; i < len; i++) {
                var newSpan = $("<a href='javascript:void(0)'></a>");     // ä¸æ•´ä½“åˆ·æ–°é¡µé¢çš„æƒ…å†µä¸‹ï¼Œå¯ä»¥ä½¿ç”¨void(0)
                newSpan.css({"left": 0, "width": fen_d * (i + 1), "z-index": len - i});  // è®¾ç½®açš„å®½åº¦ã€å±‚çº§
                newSpan.appendTo(startParent)
            }                                    //  æŠŠaæ”¾åˆ°ç±»åä¸ºâ€œstar_scoreâ€çš„divé‡Œ
            startParent.find("a").each(          // eachï¼ˆï¼‰æ–¹æ³•
                function (index, element) {
                    $(this).click(function () {        // ç‚¹å‡»äº‹ä»¶
                        if (now_cli >= 0) {
                            alert("You have already rated!")
                        } else {
                            score = show(index, $(this))         //  è°ƒç”¨showæ–¹æ³•
                            let hd = $('#house_id').text();
                            let ht = $('#house_type').text();
                            var lists = ht + "," + hd + "," + score;
                            $.ajax({
                                url: '/score',
                                type: "post",
                                data: {'score': lists},
                                dataType: 'json',
                                traditional: true,
                                async: false,
                                success: function (d) {
                                    alert("Your rating is: " + d);
                                    now_cli = index;          // å½“å‰açš„ç´¢å¼•å€¼
                                    show(index, $(this));
                                },
                                error: function (e) {
                                    alert("You must login before rating!");
                                }
                            });
                        }
                    });
                    $(this).mouseenter(function () {    /* mouseenteräº‹ä»¶(ä¸ mouseover äº‹ä»¶ä¸åŒï¼Œåªæœ‰åœ¨é¼ æ ‡æŒ‡é’ˆç©¿è¿‡è¢«é€‰å…ƒç´ æ—¶ï¼Œ
		  	                                 æ‰ä¼šè§¦å‘ mouseenter äº‹ä»¶ã€‚å¦‚æœé¼ æ ‡æŒ‡é’ˆç©¿è¿‡ä»»ä½•å­å…ƒç´ ï¼ŒåŒæ ·ä¼šè§¦å‘ mouseover äº‹ä»¶ã€‚) */
                        if (now_cli >= 0) {
                        } else {
                            show(index, $(this));
                        }
                    });
                    $(this).mouseleave(function () {    // mouseleaveäº‹ä»¶
                        if (now_cli >= 0) {
                            var scor = preA * (parseInt(now_cli) + 1);         // è¯„åˆ†
                            startParent.find("a").removeClass("clibg");  // æ¸…é™¤açš„â€œclibgâ€ç±»
                            startParent.find("a").eq(now_cli).addClass("clibg"); // eq()é€‰æ‹©å™¨ï¼Œé€‰å–ç´¢å¼•å€¼ä¸ºâ€œnow_cliâ€çš„aï¼Œç»™å®ƒåŠ ä¸Šâ€œclibgâ€ç±»
                            var ww = fen_d * (parseInt(now_cli) + 1);                  // å½“å‰açš„å®½åº¦
                            startParent.find("a").eq(now_cli).css({"width": ww, "left": "0"});  // ç»™ç´¢å¼•å€¼ä¸ºâ€œnow_cliâ€çš„aåŠ ä¸Šå®½åº¦â€œwwâ€å’Œleftå€¼
                            if (countScore) {
                                countScore.text(scor)
                            }
                        } else {
                            startParent.find("a").removeClass("clibg");
                            if (countScore) {
                                countScore.text("")
                            }
                        }
                    })
                });

            // showæ–¹æ³•
            function show(num, obj) {
                var n = parseInt(num) + 1;
                var lefta = num * fen_d;
                var ww = fen_d * n;
                var scor = preA * n;                        // è¯„åˆ†
                (len > 5) ? atu = options.types[parseInt(num)] : atu = options.types[parseInt(num) + 10];       // ç”¨æˆ·æ€åº¦
                object.find("a").removeClass("clibg");  // æ¸…é™¤æ‰€æœ‰açš„â€œclibgâ€ç±»
                obj.addClass("clibg");                  // ç»™å½“å‰aæ·»åŠ â€œclibgâ€ç±»
                obj.css({"width": ww, "left": "0"});       // ç»™å½“å‰aæ·»åŠ å®½åº¦â€œwwâ€å’Œleftå€¼
                countScore.text(scor);                  // æ˜¾ç¤ºè¯„åˆ†
                atti.text(atu);                        // æ˜¾ç¤ºç”¨æˆ·æ€åº¦
                return scor;
            }
        };
        scoreFun($("#startone"));
        //æ˜¾ç¤ºåˆ†æ•°
        $(".show_number li p").each(function (index, element) {
            var num = $(this).attr("tip");
            var www = num * 2 * 16;//
            $(this).css("width", www);
            $(this).parent(".atar_Show").siblings("span").text("Your Rating is: " + num);
        });

        {#è·å–ä»Šå¤©çš„æ—¥æœŸ#}
        let day = new Date();
        day.setTime(day.getTime());
        let s = day.getFullYear() + "-" + (day.getMonth() + 1) + "-" + day.getDate();

        Array.prototype.remove = function (val) {
            let index = this.indexOf(val);
            if (index > -1) {
                this.splice(index, 1);
            }
        };

        {#è·å–å¯é¢„çº¦æ˜ŸæœŸ#}
        let week = $('#week_number').text();
        let array = [0, 1, 2, 3, 4, 5, 6];
        array.remove(parseInt(week))

        {#æ—¥å†#}
        $('#date').datetimepicker({
            format: 'YYYY-MM-DD',
            locale: moment.locale('zh-cn'),
            defaultDate: s,
            daysOfWeekDisabled: array
        });

        {# æ˜¾ç¤ºæˆ¿å±‹å…·ä½“ä¿¡æ¯ #}
        function a(){
            let name = $('#house_name').text();
            alert(name);
        }
        function b(){
            let add = $('#address').text();
            alert(add);
        }

    </script>

{% endblock %}